<aside class="sidebar">
    <div class="sidebar-header mb-4">
        <h2 class="text-xl font-bold mb-3 text-center text-brand-purple dark:text-brand-purple-light">محادثاتي</h2>
        <form action="{{ url_for('create_chat') }}" method="post" class="flex flex-col gap-2">
             <label for="model-select" class="text-xs text-light-muted-foreground dark:text-dark-muted-foreground self-start">اختر النموذج:</label>
             <select name="model" id="model-select" required class="w-full p-2 border border-light-border dark:border-dark-border rounded-md bg-light-input dark:bg-dark-input text-sm focus:ring-brand-blue focus:border-brand-blue text-light-foreground dark:text-dark-foreground">
                <!-- نماذج Hugging Face المجانية -->
                <option value="mistralai/Mistral-7B-Instruct-v0.2">Mistral 7B Instruct</option>
                <option value="google/gemma-1.1-7b-it">Gemma 1.1 7B IT</option>
                <option value="HuggingFaceH4/zephyr-7b-beta">Zephyr 7B Beta</option>
                <!-- نماذج أخرى يمكن إضافتها -->
                {% if config.GOOGLE_API_KEY %}
                <option value="google/gemini-1.5-flash">Google Gemini Flash</option>
                {% endif %}
                {% if config.DEEPSEEK_API_KEY %}
                <option value="deepseek/deepseek-chat">Deepseek Chat</option>
                {% endif %}
            </select>
            <button type="submit" class="w-full bg-brand-purple hover:bg-brand-purple-dark text-white font-medium py-2 px-4 rounded-md transition duration-200 flex items-center justify-center gap-2">
                <i class="fas fa-plus"></i> محادثة جديدة
            </button>
        </form>
    </div>
    <hr class="border-light-border dark:border-dark-border my-3">
    <div class="flex-1 overflow-y-auto pr-1 -mr-1 sidebar-chat-list-container">
        <ul class="chat-dropdown-list space-y-1">
            {% for chat in chats %}
            <li class="chat-dropdown-item group relative rounded-md {% if current_chat and current_chat.id == chat.id %} bg-light-accent dark:bg-dark-accent {% else %} hover:bg-light-muted dark:hover:bg-dark-muted {% endif %}" data-chat-id="{{ chat.id }}">
                <a href="{{ url_for('chat_view', chat_id=chat.id) }}" class="block w-full text-right px-3 py-2 text-sm truncate {% if current_chat and current_chat.id == chat.id %} text-light-accent-foreground dark:text-dark-accent-foreground font-medium {% else %} text-light-foreground dark:text-dark-foreground {% endif %}">
                    {{ chat.title }}
                </a>
                <div class="chat-actions absolute left-2 top-1/2 transform -translate-y-1/2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-150">
                    <button class="rename-chat-btn text-xs p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-500 dark:text-gray-400" title="إعادة تسمية">
                        <i class="fas fa-pen fa-fw"></i>
                    </button>
                    <button class="delete-chat-btn text-xs p-1 rounded hover:bg-red-100 dark:hover:bg-red-900/50 text-red-500 dark:text-red-400" title="حذف">
                        <i class="fas fa-trash fa-fw"></i>
                    </button>
                </div>
            </li>
            {% else %}
            <li class="text-center text-sm text-light-muted-foreground dark:text-dark-muted-foreground py-4">ابدأ محادثة جديدة!</li>
            {% endfor %}
        </ul>
    </div>
     <!-- زر تبديل الوضع الليلي -->
     <div class="mt-auto pt-4 border-t border-light-border dark:border-dark-border">
        <button id="theme-toggle" class="w-full flex items-center justify-center gap-2 py-2 px-4 rounded-md text-sm text-light-muted-foreground dark:text-dark-muted-foreground hover:bg-light-muted dark:hover:bg-dark-muted transition-colors">
            <i class="fas fa-sun theme-icon-light"></i>
            <i class="fas fa-moon theme-icon-dark hidden"></i>
            <span class="theme-text">الوضع الليلي</span>
        </button>
    </div>
</aside>
